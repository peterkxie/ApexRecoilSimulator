<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Apex Recoil Simulator</title>
</head>
<body>

<!-- Recoil patterns -->
<script>
    let patterns = {
        "R-301": [
            [0, 10],
            [3, 5]
        ]
    }
</script>

<canvas id="myCanvas" width="400" height="500" style="border: 1px solid black;"></canvas>
<div id="recoilPatternCreationPanel">
    <button onclick="createRecoilPattern()">Create Recoil Pattern</button>
    <button onclick="undoRecoilPatternMove()">Undo</button>
    <button onclick="saveRecoilPattern()">Save</button>
    <button onclick="cancelRecoilPattern()">Cancel</button>
</div>
<div id="debug">
    <p id="debugOutput"></p>
</div>

<script>
    let canvasElement = document.getElementById("myCanvas");
    let context = canvasElement.getContext("2d");

    let dotSize = 3;

    // Global state variables
    let editMode = false;

    function getCanvas() {
        return canvasElement;
    }
    function getCanvasContext() {
        return context;
    }

    function clearCanvas() {
        getCanvasContext().clearRect(0, 0, getCanvas().width, getCanvas().height);
    }

    function drawRecoilPattern(recoilPatternArray) {
        let coordinate = [0, 0];
        drawDotC(htoc(coordinate[0], coordinate[1]));
        recoilPatternArray.forEach(value => {
            coordinate[0] = coordinate[0] + value[0];
            coordinate[1] = coordinate[1] + value[1];
            drawDotC(htoc(coordinate[0], coordinate[1]))
        });
    }

    function drawDotC(coordinate) {
        getCanvasContext().fillRect(coordinate[0], coordinate[1], dotSize, dotSize);
    }

    function drawDotH(coordinate) {
        let cCoord = htoc(coordinate[0], coordinate[1]);
        getCanvasContext().fillRect(cCoord[0], cCoord[1], dotSize, dotSize);
    }

    function eraseDotC(coordinate) {
        getCanvasContext().fillRect(coordinate[0], coordinate[1], dotSize, dotSize);
    }

    function eraseDotH(coordinate) {
        let cCoord = htoc(coordinate[0], coordinate[1]);
        getCanvasContext().fillRect(cCoord[0], cCoord[1], dotSize, dotSize);
    }

    // Convert human coordinate to canvas coordinate
    // Coordinate system is x axis along the bottom, y axis in the middle
    // htoc = human to canvas
    function htoc(x, y) {
        return [
            x + getCanvas().width / 2,
            getCanvas().height - y - 40
        ];
    }

    // ctoh = canvas to human
    function ctoh(x, y) {
        return [
            x - getCanvas().width / 2,
            getCanvas().height - y - 40
        ];
    }

    getCanvas().addEventListener("mousedown", event => {
        let rect = getCanvas().getBoundingClientRect();
        let x = event.clientX - rect.left;
        let y = event.clientY - rect.top;
    });

    ////////////////// Recoil pattern creation //////////////////

    let recoilPattern = [];
    let coordTracker = [0, 0];

    function createRecoilPattern() {
        editMode = true;
        clearCanvas();
        drawDotC(htoc(0, 0));
        coordTracker = [0, 0];
        recoilPattern.length = 0;

        console.log(recoilPattern);
    }

    function undoRecoilPatternMove() {
        recoilPattern.pop();

        // Redraw full canvas because i'm too lazy to figure out how to undo
        clearCanvas();

        drawRecoilPattern(recoilPattern);
        document.getElementById("debugOutput").innerText = recoilPattern;
    }

    getCanvas().addEventListener("mousedown", event => {
        if (!editMode) { return; }

        let rect = getCanvas().getBoundingClientRect();
        let x = event.clientX - rect.left;
        let y = event.clientY - rect.top;
        let newCoord = ctoh(x, y);

        recoilPattern.push([newCoord[0] - coordTracker[0], newCoord[1] - coordTracker[1]]);
        coordTracker[0] = newCoord[0];
        coordTracker[1] = newCoord[1];
        drawDotH(coordTracker);
        document.getElementById("debugOutput").innerText = recoilPattern;
    });
</script>

</body>
</html>